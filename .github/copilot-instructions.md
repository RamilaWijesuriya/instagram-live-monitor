# Copilot Instructions

## Project Summary
This project, **Instagram Live Monitor**, is an Express and React-based application that authenticates multiple Instagram accounts, fetches active live streams, and notifies a front-end in real-time using Socket.IO.

## Coding Standards

### TypeScript Rules
- **No `any` types**: Always use explicit types or generics.
- **No unused variables**: Remove or comment out unused variables to maintain clean code.
- **Always `await` Promises**: Ensure all asynchronous calls are properly awaited to avoid unhandled promise rejections.

### ESLint + Prettier Configuration
- **ESLint**: Enforces `eslint:recommended`, `plugin:@typescript-eslint/recommended`, and `prettier` rules.
- **Prettier**: Formats code with consistent style (e.g., single quotes, trailing commas).

Refer to the following configuration files:
- `.eslintrc.cjs`
- `eslint.config.js`
- `.prettierrc`

## Architecture Notes

### Service Layering
- **Retry with Exponential Back-off**: Use `p-limit` to control concurrency and retry failed operations.
- **Error Handling**: Centralized error handling via `errorHandler` middleware in `src/utils/errorHandler.ts`.
- **Data Validation**: Validate incoming data using Mongoose schemas and TypeScript interfaces.

### Testing Framework
- **Jest**: Configured for both server and client testing. Coverage reports are generated in the `coverage/` directory.

## Folder Structure
```
server/
  ├── src/
  │   ├── app.ts
  │   ├── config.ts
  │   ├── controllers/
  │   ├── models/
  │   ├── routes/
  │   ├── services/
  │   ├── types/
  │   ├── utils/
  ├── Dockerfile
  ├── package.json
  ├── tsconfig.json
  ├── jest.config.js
  ├── .eslintrc.cjs
  ├── eslint.config.js

client/
  ├── src/
  │   ├── api.ts
  │   ├── App.tsx
  │   ├── index.css
  │   ├── main.tsx
  │   ├── pages/
  │   ├── services/
  ├── Dockerfile
  ├── package.json
  ├── tsconfig.json
  ├── vite.config.ts

.env
.env.example
README.md
docker-compose.yml
```

## Usage Guidelines

## Error-Logging & Rerun Framework

1. **Centralized Logger**  
   - All application errors (Express, WebSocket, CLI) must go through `src/utils/logger.ts`.  
   - Use `logs/errors.log` for persistent archives.

2. **CLI Wrappers**  
   - Use `scripts/run-and-log.ts` to invoke linting/tests so failures auto-append to the log.  
   - Use `scripts/rerun-errors.ts` to replay only the files that last failed.

3. **When Adding New Scripts**  
   - Always register new error-capturing scripts here so Copilot will scaffold appropriate import paths and logging calls.

4. **Copilot Helpers**  
   - To regenerate or modify any logging behavior, ask:  
     > “Add error logging to `<filename>` using our centralized logger.”  

### Asking Copilot for New Endpoints or Modules
- **Focus on Missing Code**: Request Copilot to generate only missing controllers, services, or modules.
- **Avoid Rewriting Existing Code**: Ensure Copilot does not overwrite existing, functional code.
- **Provide Context**: Include relevant TypeScript interfaces, expected input/output, and error-handling requirements in your prompt.

### Example Prompt
```markdown
"Generate a new controller for managing user profiles. It should include endpoints for creating, updating, and deleting profiles. Use the `IUser` interface and validate input with Mongoose schemas."
```

## Self-Audit Checklist
Before committing code generated by Copilot, ensure the following:

1. **Type Errors**: Scan for and fix any TypeScript type errors.
2. **Promise Misuse**: Verify all Promises are properly awaited or handled.
3. **Template Literals**: Check for misuse of template literals (e.g., missing variables or incorrect syntax).
4. **Code Style**: Run `npm run lint` and `npm run format` to ensure code adheres to ESLint and Prettier rules.
5. **Testing**: Add or update tests for new functionality and ensure all tests pass.

### Example Commands
```bash
# Lint and format code
npm run lint
npm run format

# Run tests
npm test
```

By following these guidelines, you can ensure high-quality, maintainable code contributions to the project.
